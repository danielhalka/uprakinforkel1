<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Activity Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===============================
   üçé IOS STYLE UI
================================ */

:root{
    --bg:#f2f2f7;
    --card:#ffffff;
    --text:#1c1c1e;
    --border:#e5e5ea;
    --primary:#007aff;
}

.dark{
    --bg:#000;
    --card:#1c1c1e;
    --text:#fff;
    --border:#2c2c2e;
    --primary:#0a84ff;
}

*{
    box-sizing:border-box;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
}

body{
    margin:0;
    padding:18px;
    background:var(--bg);
    color:var(--text);
}

.container{
    max-width:900px;
    margin:auto;
}

/* HEADER */
header{
    text-align:center;
    margin-bottom:22px;
}

/* CARD */
.card{
    background:var(--card);
    border-radius:22px;
    padding:20px;
    margin-bottom:16px;
    box-shadow:0 4px 14px rgba(0,0,0,.06);
    overflow:hidden;
}

/* INPUT */
input,select{
    width:100%;
    height:48px;
    border-radius:14px;
    border:1px solid var(--border);
    background:#f9f9fb;
    padding:0 14px;
    font-size:15px;
    margin-bottom:12px;
    outline:none;
}

input:focus,select:focus{
    border-color:var(--primary);
    background:white;
}

input[type="datetime-local"]{
    appearance:none;
    -webkit-appearance:none;
}

/* BUTTON */
button{
    width:100%;
    height:50px;
    border:none;
    border-radius:16px;
    background:var(--primary);
    color:white;
    font-weight:600;
    font-size:15px;
    cursor:pointer;
}

header button{
    background:#e5e5ea;
    color:#000;
    margin-top:10px;
}

/* ACTIVITY LIST */
.activity{
    background:#f9f9fb;
    padding:14px;
    border-radius:16px;
    margin-bottom:12px;
}

.activity.done{
    background:#d1f5dd;
    text-decoration:line-through;
}

.actions{
    margin-top:8px;
}

.actions button{
    width:auto;
    height:32px;
    padding:5px 10px;
    font-size:12px;
    margin-right:6px;
}

/* TAG */
.tag{
    display:inline-block;
    border-radius:999px;
    padding:4px 12px;
    font-size:11px;
    color:white;
    margin:6px 0;
}

.tag.Olahraga{background:#ff7675;}
.tag.Kerja{background:#0984e3;}
.tag.Belajar{background:#6c5ce7;}
.tag.Istirahat{background:#00b894;}

/* STATS */
.stats{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
}

.stat{
    flex:1;
    min-width:150px;
    border-radius:18px;
    padding:18px;
    background:var(--primary);
    color:white;
    text-align:center;
}
</style>
</head>

<body>

<div class="container">

<header>
    <h2>üèÉ Activity Tracker</h2>
    <button onclick="toggleDark()">üåô Dark Mode</button>
</header>

<!-- FORM -->
<div class="card">
    <h3>Tambah Aktivitas</h3>

    <input id="activityName" placeholder="Nama aktivitas">

    <select id="activityCategory">
        <option value="Olahraga">üèÉ Olahraga</option>
        <option value="Kerja">üíº Kerja</option>
        <option value="Belajar">üìö Belajar</option>
        <option value="Istirahat">üò¥ Istirahat</option>
    </select>

    <!-- DATETIME GABUNG -->
    <input type="datetime-local" id="activityDateTime">

    <button onclick="getLocation()">üìç Ambil Lokasi</button>
    <small id="locationStatus"></small>

    <label>Custom Alarm</label>
    <input type="file" id="customAlarm" accept="audio/*">

    <label>Volume Alarm</label>
    <input type="range" min="0" max="1" step="0.1" id="volume">

    <button onclick="addActivity()">Tambah Aktivitas</button>
</div>

<!-- SEARCH -->
<div class="card">
    <input id="search" placeholder="üîç Cari aktivitas..." oninput="show()">
</div>

<!-- LIST -->
<div class="card">
    <h3>Daftar Aktivitas</h3>
    <div id="list"></div>
</div>

<!-- STATS -->
<div class="card">
    <h3>Statistik</h3>
    <div class="stats">
        <div class="stat">
            <h2 id="totalDone">0</h2>
            <small>Selesai</small>
        </div>
        <div class="stat">
            <h2 id="totalAll">0</h2>
            <small>Total</small>
        </div>
    </div>
</div>

<audio id="alarmSound"></audio>

</div>

<script>
let activities = JSON.parse(localStorage.getItem("activities")) || [];
let currentLocation = null;

const alarmSound = document.getElementById("alarmSound");

alarmSound.src = localStorage.getItem("alarm") ||
"https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg";

alarmSound.volume = localStorage.getItem("volume") || 1;

volume.value = alarmSound.volume;

/* custom alarm */
customAlarm.onchange = e => {
    const file = e.target.files[0];
    if(!file) return;
    const url = URL.createObjectURL(file);
    alarmSound.src = url;
    localStorage.setItem("alarm",url);
};

volume.oninput = e => {
    alarmSound.volume = e.target.value;
    localStorage.setItem("volume",e.target.value);
};

/* location */
function getLocation(){
    if(!navigator.geolocation) return alert("GPS tidak didukung");

    locationStatus.innerText="Mengambil lokasi...";

    navigator.geolocation.getCurrentPosition(p=>{
        currentLocation={
            lat:p.coords.latitude,
            lng:p.coords.longitude
        };
        locationStatus.innerText="üìç Lokasi tersimpan";
    });
}

function save(){
    localStorage.setItem("activities",JSON.stringify(activities));
}

function status(a){
    const now=new Date();
    const t=new Date(a.datetime);

    if(a.done) return "‚úÖ Done";
    if(now<t) return "‚è≥ Upcoming";
    return "üî• Ongoing";
}

/* tambah */
function addActivity(){

    if(!activityName.value || !activityDateTime.value){
        alert("Lengkapi data aktivitas");
        return;
    }

    activities.push({
        id:Date.now(),
        name:activityName.value,
        category:activityCategory.value,
        datetime:activityDateTime.value,
        done:false,
        alarmed:false,
        location:currentLocation
    });

    activityName.value="";
    activityDateTime.value="";
    currentLocation=null;

    save();
    show();
}

/* tampil */
function show(){

    list.innerHTML="";
    const q=search.value.toLowerCase();

    activities
    .filter(a=>a.name.toLowerCase().includes(q))
    .forEach((a,i)=>{

        const map=a.location?
        `<iframe width="100%" height="140" style="border-radius:12px;border:0"
        src="https://www.google.com/maps?q=${a.location.lat},${a.location.lng}&z=15&output=embed"></iframe>`:"";

        list.innerHTML+=`
        <div class="activity ${a.done?"done":""}">
            <b>${a.name}</b>
            <div class="tag ${a.category}">${a.category}</div>
            <small>${new Date(a.datetime).toLocaleString()} ‚Ä¢ ${status(a)}</small>
            ${map}
            <div class="actions">
                ${a.done?"":`<button onclick="finish(${i})">‚úî</button>`}
                <button onclick="edit(${i})">‚úèÔ∏è</button>
                <button onclick="remove(${i})">üóëÔ∏è</button>
            </div>
        </div>`;
    });

    totalAll.innerText=activities.length;
    totalDone.innerText=activities.filter(a=>a.done).length;
}

function finish(i){activities[i].done=true;save();show();}
function edit(i){
    const n=prompt("Edit nama",activities[i].name);
    if(n) activities[i].name=n;
    save();show();
}
function remove(i){
    if(confirm("Hapus aktivitas?")){
        activities.splice(i,1);
        save();show();
    }
}

/* alarm */
setInterval(()=>{
    const now=new Date();

    activities.forEach(a=>{
        if(a.done || a.alarmed) return;

        const t=new Date(a.datetime);

        if(now>=t){
            alarmSound.play();

            if(confirm("‚è∞ "+a.name+"\nSnooze 5 menit?")){
                t.setMinutes(t.getMinutes()+5);
                a.datetime = t.toISOString().slice(0,16);
            }

            a.alarmed=true;
            save();
        }
    });
},1000);

function toggleDark(){
    document.body.classList.toggle("dark");
}

show();
</script>

</body>
</html>
