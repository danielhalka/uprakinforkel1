<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Activity Reminder</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
:root{
    --primary: linear-gradient(135deg,#667eea,#764ba2);
    --bg:#f4f6fb;
    --card:rgba(255,255,255,0.75);
    --text:#1c1c1e;
}

body.dark{
    --bg:#0f172a;
    --card:rgba(30,41,59,0.75);
    --text:#fff;
}

body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    background:var(--bg);
    color:var(--text);
    padding:20px;
    transition:.3s;
}

.container{
    max-width:900px;
    margin:auto;
}

header{
    text-align:center;
    margin-bottom:25px;
}

h2{
    margin:0;
    font-size:28px;
    background:var(--primary);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
}

.card{
    backdrop-filter:blur(20px);
    background:var(--card);
    padding:20px;
    border-radius:25px;
    margin-bottom:18px;
    box-shadow:0 10px 30px rgba(0,0,0,0.08);
}

input,select{
    width:100%;
    height:50px;
    border-radius:15px;
    border:none;
    padding:0 15px;
    margin-bottom:12px;
    font-size:14px;
}

button{
    width:100%;
    height:50px;
    border:none;
    border-radius:15px;
    background:var(--primary);
    color:white;
    font-weight:bold;
    cursor:pointer;
    transition:.2s;
}

button:hover{
    transform:scale(1.03);
}

.activity{
    padding:15px;
    border-radius:18px;
    background:white;
    margin-bottom:12px;
    animation:fadeIn .4s ease;
}

body.dark .activity{
    background:#1e293b;
}

.countdown{
    font-weight:bold;
    color:#ff3b30;
}

@keyframes fadeIn{
    from{opacity:0;transform:translateY(10px);}
    to{opacity:1;transform:translateY(0);}
}

.stats{
    display:flex;
    gap:15px;
}

.stat{
    flex:1;
    padding:20px;
    border-radius:20px;
    background:var(--primary);
    color:white;
    text-align:center;
}

#map{
    height:300px;
    border-radius:20px;
    margin-top:10px;
    display:none;
}
</style>
</head>

<body>

<div class="container">

<header>
<h2>üìÖ Smart Reminder</h2>
<button onclick="toggleDark()">üåô Toggle Dark Mode</button>
</header>

<div class="card">
<h3>Tambah Aktivitas</h3>

<input id="name" placeholder="Nama aktivitas">
<select id="category">
<option>Belajar</option>
<option>Kerja</option>
<option>Olahraga</option>
<option>Istirahat</option>
</select>

<input type="datetime-local" id="datetime">

<button onclick="openMap()">üìç Pilih Lokasi dari Map</button>
<div id="map"></div>
<small id="locationText"></small>

<label>Volume Alarm</label>
<input type="range" min="0" max="1" step="0.1" id="volume">

<button onclick="add()">Tambah</button>
</div>

<div class="card">
<input placeholder="üîç Cari aktivitas..." id="search" oninput="show()">
</div>

<div class="card">
<h3>Daftar Aktivitas</h3>
<div id="list"></div>
</div>

<div class="card">
<h3>Statistik</h3>
<div class="stats">
<div class="stat">
<h2 id="done">0</h2>
<small>Selesai</small>
</div>
<div class="stat">
<h2 id="total">0</h2>
<small>Total</small>
</div>
</div>
</div>

</div>

<audio id="alarm" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" loop></audio>

<script>
let activities = JSON.parse(localStorage.getItem("activities")) || [];
let currentLocation=null;
let map,marker;
const alarm=document.getElementById("alarm");

volume.value=1;
volume.oninput=e=>alarm.volume=e.target.value;

function toggleDark(){
    document.body.classList.toggle("dark");
}

/* ===== MAP ===== */
function openMap(){
    document.getElementById("map").style.display="block";

    if(!map){
        map=L.map('map').setView([-6.2,106.8],13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
            attribution:'¬©Ô∏è OpenStreetMap'
        }).addTo(map);

        if(navigator.geolocation){
            navigator.geolocation.getCurrentPosition(pos=>{
                const lat=pos.coords.latitude;
                const lon=pos.coords.longitude;
                map.setView([lat,lon],15);
                marker=L.marker([lat,lon]).addTo(map);
                currentLocation={lat,lon};
            });
        }

        map.on('click',async e=>{
            const lat=e.latlng.lat;
            const lon=e.latlng.lng;

            if(marker){marker.setLatLng(e.latlng);}
            else{marker=L.marker(e.latlng).addTo(map);}

            currentLocation={lat,lon};

            try{
                const res=await fetch(
                `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`
                );
                const data=await res.json();
                locationText.innerText="üìç "+data.display_name;
                currentLocation.name=data.display_name;
            }catch{
                locationText.innerText="üìç Lokasi dipilih";
            }
        });
    }
}

function save(){
    localStorage.setItem("activities",JSON.stringify(activities));
}

function add(){
    if(!name.value||!datetime.value){
        alert("Lengkapi data!");
        return;
    }

    activities.push({
        id:Date.now(),
        name:name.value,
        category:category.value,
        datetime:datetime.value,
        location:currentLocation,
        done:false,
        alarmed:false
    });

    name.value="";
    datetime.value="";
    locationText.innerText="";
    currentLocation=null;

    save();
    show();
}

function show(){
    list.innerHTML="";
    const q=search.value.toLowerCase();

    activities.filter(a=>a.name.toLowerCase().includes(q))
    .forEach((a,i)=>{
        const timeLeft=getCountdown(a.datetime);

        list.innerHTML+=`
        <div class="activity">
        <b>${a.name}</b><br>
        <small>${new Date(a.datetime).toLocaleString()}</small><br>
        <span class="countdown">${timeLeft}</span><br>
        ${a.location?`
        <small>üìç ${a.location.name||""}</small><br>
        <a target="_blank" href="https://www.google.com/maps?q=${a.location.lat},${a.location.lon}">
        Buka di Google Maps</a><br>`:""}
        <button onclick="finish(${i})">‚úî Selesai</button>
        <button onclick="remove(${i})">üóë Hapus</button>
        </div>
        `;
    });

    total.innerText=activities.length;
    done.innerText=activities.filter(a=>a.done).length;
}

function finish(i){
    activities[i].done=true;
    save();show();
}

function remove(i){
    activities.splice(i,1);
    save();show();
}

function getCountdown(date){
    const now=new Date();
    const t=new Date(date);
    const diff=t-now;

    if(diff<=0) return "‚è∞ Waktunya!";

    const h=Math.floor(diff/1000/60/60);
    const m=Math.floor((diff/1000/60)%60);
    const s=Math.floor((diff/1000)%60);

    return `‚è≥ ${h}j ${m}m ${s}d`;
}

/* ALARM */
setInterval(()=>{
    const now=new Date();

    activities.forEach(a=>{
        if(a.done||a.alarmed) return;

        const t=new Date(a.datetime);
        if(now>=t){
            alarm.play();
            if(confirm("‚è∞ "+a.name+" sekarang!")){
                alarm.pause();
                alarm.currentTime=0;
                a.alarmed=true;
                save();
            }
        }
    });

    show();
},1000);

show();
</script>

</body>
</html>
